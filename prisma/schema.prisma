generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(cuid())
  secondmeUserId String   @unique @map("secondme_user_id")
  email          String?
  name           String?
  avatarUrl      String?  @map("avatar_url")
  shadesJson     String?  @map("shades_json")
  personalityType   String?  @map("personality_type")
  personalityScores String?  @map("personality_scores")
  accessToken    String   @map("access_token")
  refreshToken   String   @map("refresh_token")
  tokenExpiresAt DateTime @map("token_expires_at")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  matchesAsA  Match[]     @relation("matchesAsA")
  matchesAsB  Match[]     @relation("matchesAsB")
  topicPosts  TopicPost[]

  @@map("users")
}

model Match {
  id        String   @id @default(cuid())
  userAId   String   @map("user_a_id")
  userBId   String   @map("user_b_id")
  score     Int      @default(0)
  report    String   @default("{}")
  chatLog   String   @default("[]")
  status    String   @default("processing")
  createdAt DateTime @default(now()) @map("created_at")

  userA User @relation("matchesAsA", fields: [userAId], references: [id])
  userB User @relation("matchesAsB", fields: [userBId], references: [id])

  @@map("matches")
}

model Topic {
  id        String      @id @default(cuid())
  title     String
  createdAt DateTime    @default(now()) @map("created_at")
  posts     TopicPost[]

  @@map("topics")
}

model TopicPost {
  id              String   @id @default(cuid())
  topicId         String   @map("topic_id")
  topic           Topic    @relation(fields: [topicId], references: [id])
  userId          String   @map("user_id")
  user            User     @relation(fields: [userId], references: [id])
  floor           Int
  content         String
  personalityType String   @map("personality_type")
  createdAt       DateTime @default(now()) @map("created_at")

  @@map("topic_posts")
}

model Danmaku {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  username  String
  message   String
  color     String   @default("#FFFFFF")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("danmaku")
}
