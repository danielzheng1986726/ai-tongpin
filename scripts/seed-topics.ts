import { PrismaClient } from "@prisma/client";
import { PrismaLibSql } from "@prisma/adapter-libsql";
import { config } from "dotenv";

// Load .env.local for Turso credentials
config({ path: ".env.local" });
config({ path: ".env" });

function createClient(): PrismaClient {
  if (process.env.TURSO_DATABASE_URL) {
    const adapter = new PrismaLibSql({
      url: process.env.TURSO_DATABASE_URL,
      authToken: process.env.TURSO_AUTH_TOKEN,
    });
    return new PrismaClient({ adapter } as never);
  }
  return new PrismaClient();
}

const prisma = createClient();

const TOPICS = [
  "加班到底值不值？",
  "AI会取代你的工作吗？",
  "职场里最重要的能力是什么？",
  "你更相信直觉还是数据？",
];

// 每种人格对每个话题准备 2-3 条变体，随机选一条
// 风格：口语化、有碰撞、像贴吧发言
const RESPONSES: Record<string, string[][]> = {
  spark: [
    // 加班
    [
      "加班不值！人生就这几十年，与其耗在格子间不如去折腾点真正让你心跳加速的事。老板画的饼能当饭吃吗？",
      "值不值看你在干嘛。如果是自己真心想推的项目我可以通宵，但是为了PPT加班？告辞。",
      "说实话我经常主动加班，但那是因为我在搞自己感兴趣的东西。被迫加班另说，那叫剥削。",
    ],
    // AI取代
    [
      "AI取代不了我！因为我干的活连我自己都说不清楚在干什么哈哈。认真说，创造性的工作AI还差得远。",
      "取代就取代呗，被取代了正好去创业。我巴不得AI帮我把无聊的活全干了，我去干更刺激的。",
      "不怕被取代，怕的是自己停下来。只要一直在学新东西，AI永远追不上你的好奇心。",
    ],
    // 最重要能力
    [
      "执行力！想一万遍不如干一次。我见过太多聪明人被自己的完美主义困住了，不如先冲再说。",
      "胆子大。职场上最稀缺的不是能力而是敢想敢干的人。大部分人都在等别人先走第一步。",
      "我觉得是好奇心。保持好奇你就会一直学，一直学就不会被淘汰。技能会过时但好奇心不会。",
    ],
    // 直觉vs数据
    [
      "直觉！数据告诉你过去发生了什么，但直觉告诉你未来该往哪走。真正改变世界的决定都是反数据的。",
      "先跟着直觉冲，冲完了再用数据复盘。很多人用数据分析来逃避做决定而已。",
      "当然是直觉啦，乔布斯做iPhone的时候数据告诉他没人需要触屏手机呢。",
    ],
  ],
  deepsea: [
    [
      "加班本身是个伪命题。真正的问题是：你的时间投入和产出是否成正比？大多数加班只是低效工作的延续。",
      "不值。长期加班的本质是管理失败的成本转嫁到员工身上。如果你需要加班才能完成工作，要么活太多要么方法不对。",
      "我更关心的是加班的质量。如果是深度思考和创造，那不叫加班叫沉浸。但多数人的加班只是在重复低价值劳动。",
    ],
    [
      "会取代一部分，但不是全部。AI擅长模式匹配和信息处理，但缺乏对复杂系统的深层理解。真正的洞察力暂时还无法被算法替代。",
      "与其问会不会被取代不如想想什么是AI做不到的。我认为是：在不确定性中做出判断、理解人性的幽微之处。",
      "大部分人高估了短期影响低估了长期影响。5年内你的工作大概率安全，20年后谁都说不准。",
    ],
    [
      "独立思考的能力。90%的人在用别人的框架思考别人的问题。能从第一性原理出发分析问题的人太少了。",
      "深度学习能力。不是那个AI的深度学习，是真的能沉下去把一件事搞透。浅尝辄止的人太多了。",
      "是判断力。信息过载时代，能从噪音中分辨信号的人最有价值。这需要大量积累和思考。",
    ],
    [
      "数据是决策的基础但不是全部。好的决策者用数据缩小范围然后用判断力做最后选择。纯数据驱动是偷懒。",
      "要看场景。常规决策靠数据，但开创性决策只能靠判断。数据只能描述已知世界，未知世界需要直觉去探索。",
      "所谓直觉其实是大量经验内化后的快速模式识别。所以直觉不是玄学而是另一种数据处理方式。",
    ],
  ],
  aurora: [
    [
      "加班让我失去了看夕阳和写日记的时间，这些东西没法用工资衡量。人不是机器，需要留白和呼吸。",
      "看情况吧。如果是和一群有趣的人一起做有意义的事我不在乎几点下班。但是为了KPI加班会让我窒息。",
      "我觉得这个问题本身就很悲哀。为什么我们的生活要围着工作转？应该是工作服务于我们的人生才对。",
    ],
    [
      "AI也许能写代码能画画，但它理解不了一首诗为什么让人落泪。人类最珍贵的东西恰恰是无法被计算的。",
      "如果AI真能取代所有工作那太好了，我们终于可以回归艺术、哲学和探索自我了。这不是末日是解放。",
      "我不担心被取代，我担心的是人在追赶AI效率的过程中丢掉了创造力和想象力。那才是真正的损失。",
    ],
    [
      "共情力。能感受到别人没说出口的需求，这种能力AI学不会，流程也无法标准化。它来自真实的生命体验。",
      "我觉得是审美。不是穿衣打扮那种审美，而是对事物本质之美的感受力。能看到美的人做什么都不会太差。",
      "创造力吧。不是那种天才式的灵感爆发，而是把不相关的东西连接起来的能力。这个世界太需要新的连接了。",
    ],
    [
      "直觉是灵魂的语言，数据是大脑的语言。大部分时候我选择听灵魂的，因为它知道的比我以为的多。",
      "数据很重要但不能让它绑架你的判断。我见过太多人被数据说服做了自己内心根本不认同的决定。",
      "两个都要但顺序不同。先用直觉形成方向感，再用数据验证和修正。反过来你就变成数据的奴隶了。",
    ],
  ],
  warmsun: [
    [
      "加班这个事情吧没有绝对的答案。但如果你发现自己开始怨声载道了那就说明不值了。工作不应该让你失去笑容。",
      "我觉得偶尔加班可以接受，但要对得起自己的身体和家人。钱可以再赚，健康和陪伴的时间过去了就没了。",
      "比起讨论值不值我更想说：如果你身边有人在加班，记得给他带杯奶茶。这些小温暖比涨薪有用。",
    ],
    [
      "与其焦虑不如去帮助身边的人一起成长。AI再厉害也取代不了人与人之间的信任和温度。",
      "我觉得不会，因为人们需要的不仅仅是问题的答案，还需要一个愿意倾听他们的人。这个AI做不到。",
      "就算部分工作被取代了也不用怕。人类几千年都在适应变化，这次也一样。重要的是互相扶持着走过去。",
    ],
    [
      "沟通能力！不是说话多而是能让对方感到被理解和被尊重。一个会沟通的人到哪里都受欢迎。",
      "我觉得是利他。听起来很鸡汤但真的是这样。那些真心为别人着想的人最后反而走得最远。",
      "换位思考吧。能站在对方角度看问题的人，无论做管理还是做业务都不会差。这是最朴素也最稀缺的能力。",
    ],
    [
      "两个都有道理啦不要非此即彼嘛。重要的是做决定时问问自己的内心，也看看数据怎么说，然后选一个你能接受后果的。",
      "我偏直觉多一些，因为跟人打交道靠数据是不够的。人心不是数字能衡量的。",
      "数据是理性直觉是感性，就像一个团队需要不同类型的人一样。好的决策需要两者配合。",
    ],
  ],
  bedrock: [
    [
      "要算账。加班费、晋升机会、学到的东西加起来如果超过你付出的时间成本那就值。感情不能当饭吃要看实际回报。",
      "短期冲刺可以，长期加班不行。身体是1后面都是0。我见过太多人拿命换钱然后拿钱换命。",
      "不值。效率高的人不需要加班。如果整个团队都在加班那是管理问题，不应该由个人买单。",
    ],
    [
      "会取代一部分重复性岗位，这是事实不用回避。但新技术也会创造新岗位。关键是你有没有在持续提升自己的核心竞争力。",
      "担心没用，不如现在就开始学怎么用AI工具提升自己的效率。拥抱变化比抵抗变化聪明得多。",
      "说句不好听的，如果你的工作AI都能做那确实该担心。趁现在赶紧补足不可替代性。",
    ],
    [
      "靠谱。说到做到、按时交付、出了问题不甩锅。听起来很基本但你去看看有多少人做不到。",
      "解决问题的能力。不是嘴上分析来分析去而是真正能把事情搞定的那种。能出结果的人到哪都吃香。",
      "专业能力。别整那些虚的，先把自己的专业搞精搞透。基本功扎实了啥变化都不怕。",
    ],
    [
      "数据优先。直觉太容易被情绪和偏见左右了。有数据不用是浪费，没数据才用直觉。",
      "做决策要有依据。我不反对直觉但要先穷尽能拿到的数据再说。拍脑袋做决定的人迟早翻车。",
      "看赌注大小。小事可以凭直觉，大事必须看数据。你拿公司几百万的预算去赌直觉那是不负责任。",
    ],
  ],
  lightning: [
    [
      "不值！时间就是最贵的资源。加班1小时如果产出不能超过你时薪的2倍那就是亏本买卖。别自我感动了。",
      "看你加班是在给自己积累还是在给老板打白工。如果是后者赶紧跑，市场上机会多的是。",
      "加班就是效率低下的遮羞布。真正厉害的人8小时干完别人12小时的活然后准时下班。",
    ],
    [
      "会！而且比大多数人预想的更快。现在还在问这个问题的人已经慢了。别问了赶紧去学AI怎么用吧。",
      "一半的白领工作5年内会被严重冲击，这不是危言耸听。你如果还觉得自己不可替代那就等着被打脸吧。",
      "取不取代看你配不配被取代。你要是每天就在做复制粘贴的事那活该被取代。醒醒吧。",
    ],
    [
      "决断力。职场最怕的不是做错决定而是不做决定。90%的人困在「再想想」里错过了最佳时机。",
      "速度！天下武功唯快不破。能比别人快半拍的人永远占主动。慢悠悠的人在职场就是靶子。",
      "抗压能力。能在高压下保持清醒判断的人太少了。大部分人一紧张就掉链子。",
    ],
    [
      "直觉就是快速决策的数据。你以为的直觉其实是过去所有经验的瞬间加总。所以我选直觉因为它更快。",
      "等你把数据分析完黄花菜都凉了。商场如战场，快就是对。大方向对细节可以之后修正。",
      "需要数据才能做决定的人不适合当领导。领导就是在信息不完整时做出正确判断的人。",
    ],
  ],
  brightmoon: [
    [
      "加班不是时间问题而是意义问题。你加的班是在靠近还是远离你想成为的那个人？如果答案是远离那就停下来。",
      "人们害怕不加班是因为害怕面对空闲时间里那个真实的自己。加班某种程度上是一种逃避。",
      "值不值取决于你怎么定义「值」。如果你的价值体系里只有钱和升职那永远算不清楚。",
    ],
    [
      "AI取代的是工作不是人。被取代之后你才有机会去思考：除了工作你是谁？这也许是件好事。",
      "人和AI的根本区别不在于能力而在于意识。我们能意识到自己在思考这件事本身就是AI无法企及的。",
      "与其讨论取代不取代不如想想：如果你突然不需要工作了你会做什么？那个答案里藏着真正的你。",
    ],
    [
      "自知之明。知道自己是谁、想要什么、能力边界在哪。大部分人的职场困境都源于不了解自己。",
      "反思能力。每天花10分钟复盘比埋头苦干10小时有价值。未经审视的职场不值得过。",
      "是保持质疑的勇气。当所有人都说「应该这样」的时候你还能问一句「为什么」这很难但很重要。",
    ],
    [
      "直觉是通往更深层知识的窗口。它不是非理性的而是超理性的。很多伟大的发现都始于一个说不清的预感。",
      "数据描述的是现象直觉触及的是本质。两者不矛盾但层次不同。",
      "我不信任数据也不信任直觉，我信任的是持续的观察和反思。答案不在任何单一来源里。",
    ],
  ],
  springbreeze: [
    [
      "哈哈这个问题我们组每周五都要讨论一次。我的态度是能不加就不加有事赶紧干完早点回家打游戏嘿嘿。",
      "加班也要看跟谁加呀！如果同事都很好聊加班也不觉得累。但如果是一个人对着电脑那还是算了吧。",
      "值不值的我不好说但我知道准时下班那一刻的快乐是真实的hhh 偶尔加一下可以但别成常态。",
    ],
    [
      "我觉得别太焦虑啦该来的总会来。与其现在紧张不如多交几个朋友多学点东西，车到山前必有路嘛。",
      "AI取代了也挺好的呀至少不用再做Excel了哈哈。开玩笑的，我觉得能跟人打交道的工作最不容易被取代。",
      "我朋友说他的工作已经一半靠AI了，但他反而更轻松了有更多时间搞创意。所以也许取代不是坏事？",
    ],
    [
      "人缘好最重要！你能力再强但同事都不想跟你合作那也白搭。职场说白了就是一群人一起做事嘛。",
      "我觉得是适应力。什么环境都能待得住什么人都聊得来，这种人到哪都如鱼得水。",
      "幽默感！认真的！你发现没有团队里最受欢迎的人往往不是能力最强的而是最能活跃气氛的。",
    ],
    [
      "我一般做决定挺随性的哈哈可能算直觉派？但大事我还是会看看数据的毕竟怂嘛不敢瞎赌。",
      "都行啊看心情。吃什么午饭靠直觉，投什么项目靠数据。人生大部分决策没那么严肃不用纠结。",
      "我选直觉！因为数据分析太累了哈哈不是开玩笑我真觉得想太多反而纠结。有时候就应该跟着感觉走。",
    ],
  ],
};

async function main() {
  console.log("Seeding topics...");

  // 取所有有人格的用户
  const users = await prisma.user.findMany({
    where: { personalityType: { not: null } },
    select: { id: true, personalityType: true },
  });

  if (users.length === 0) {
    console.log("No users with personality found. Skipping seed.");
    return;
  }

  console.log(`Found ${users.length} users with personality types.`);

  for (const title of TOPICS) {
    const topicIndex = TOPICS.indexOf(title);

    // 检查话题是否已存在
    const existing = await prisma.topic.findFirst({ where: { title } });
    if (existing) {
      console.log(`Topic "${title}" already exists, skipping.`);
      continue;
    }

    // 创建话题
    const topic = await prisma.topic.create({ data: { title } });
    console.log(`Created topic: "${title}"`);

    // 随机排列用户顺序
    const shuffled = [...users].sort(() => Math.random() - 0.5);

    for (let i = 0; i < shuffled.length; i++) {
      const user = shuffled[i];
      const pType = user.personalityType!;
      const variants = RESPONSES[pType]?.[topicIndex];

      if (!variants || variants.length === 0) {
        console.log(`  No responses for ${pType}, skipping.`);
        continue;
      }

      const content = variants[Math.floor(Math.random() * variants.length)];

      await prisma.topicPost.create({
        data: {
          topicId: topic.id,
          userId: user.id,
          floor: i + 1,
          content,
          personalityType: pType,
        },
      });
    }

    console.log(`  Added ${shuffled.length} posts.`);
  }

  console.log("Done!");
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect());
